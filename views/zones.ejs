<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <meta name="description" content="Découvrez toutes les zones d'intervention d'OBDExpress pour votre diagnostic automobile à domicile sur la Côte d'Azur." />
  <link rel="stylesheet" href="/css/styles.css">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    .zones-hero {
      background-color: #0066cc;
      color: white;
      padding: 3rem 1.5rem;
      text-align: center;
    }
    
    /* Style pour assurer que la carte remplit correctement son conteneur */
    #map {
      width: 100%;
      height: 400px;
    }
    @media (min-width: 768px) {
      #map {
        height: 450px;
      }
    }
    @media (min-width: 1024px) {
      #map {
        height: 500px;
      }
    }
    
    .cities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin: 3rem 0;
    }
    
    .city-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .city-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .city-card h2 {
      color: #0066cc;
      margin-bottom: 0.5rem;
    }
    
    .city-card .price {
      font-size: 1.5rem;
      font-weight: bold;
      color: #ff6600;
      margin-bottom: 0.5rem;
    }
    
    .city-card .zipcode {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .city-link {
      display: inline-block;
      background-color: #0066cc;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      text-decoration: none;
      margin-top: 1rem;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;
    }
    
    .city-link:hover {
      background-color: #0052a3;
    }
    
    .zones-info {
      background-color: #f8f9fa;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 3rem;
    }
    
    .zones-info h2 {
      margin-bottom: 1.5rem;
    }
    
    .zones-info ol {
      padding-left: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .zones-info li {
      margin-bottom: 0.75rem;
    }
    
    .cta-button {
      display: inline-block;
      background-color: #0066cc;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
      margin-top: 1rem;
      transition: background-color 0.3s ease;
    }
    
    .cta-button:hover {
      background-color: #0052a3;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    
    .map-container {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      margin: 24px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>OBDExpress</h1>
    <p>Diagnostic auto à domicile - Côte d'Azur</p>
    <nav>
      <ul>
        <li><a href="/">Accueil</a></li>
        <li><a href="/#services">Services</a></li>
        <li><a href="/zones-intervention" class="active">Zones desservies</a></li>
        <li><a href="/carte">Carte</a></li>
        <li><a href="/#tarifs">Tarifs</a></li>
        <li><a href="/#contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="zones-hero">
      <div class="container">
        <h1>Nos zones d'intervention</h1>
        <p>OBDExpress se déplace à votre domicile dans toutes ces villes de la Côte d'Azur</p>
      </div>
    </section>

    <section class="cities-list">
      <div class="container">
        <div class="cities-grid">
          <% cities.forEach(function(city) { %>
            <div class="city-card">
              <h2><%= city.name %></h2>
              <p class="price"><%= city.price %>€</p>
              <p class="zipcode">Code postal : <%= city.zipCode %></p>
              <p><%= city.description.substring(0, 100) %>...</p>
              <a href="/diagnostic-auto/<%= city.id %>" class="city-link">En savoir plus</a>
            </div>
          <% }); %>
        </div>
        
        <div class="zones-info">
          <h2>Comment fonctionne notre service ?</h2>
          
          <!-- Carte -->
          <div id="map" class="map-container"></div>
          
          <ol>
            <li>Contactez-nous pour prendre rendez-vous</li>
            <li>Notre technicien se déplace à votre domicile</li>
            <li>Diagnostic complet de votre véhicule</li>
            <li>Explication des problèmes détectés</li>
            <li>Paiement sur place ou en ligne</li>
          </ol>
          
          <p>Pour les zones au-delà de 20 km d'Antibes, un devis personnalisé vous sera proposé.</p>
          
          <div class="cta-section">
            <a href="/#contact" class="cta-button">Prendre rendez-vous</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>OBDExpress</h3>
          <p>Diagnostic automobile à domicile sur la Côte d'Azur</p>
        </div>
        <div class="footer-section">
          <h3>Zones principales</h3>
          <ul>
            <li><a href="/diagnostic-auto/antibes">Antibes</a></li>
            <li><a href="/diagnostic-auto/cannes">Cannes</a></li>
            <li><a href="/diagnostic-auto/cagnes-sur-mer">Cagnes-sur-Mer</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contact</h3>
          <p>Tél : 06 00 00 00 00</p>
          <p>Email : contact@obdexpress.fr</p>
        </div>
      </div>
      <p class="copyright">&copy; <%= new Date().getFullYear() %> OBDExpress - Tous droits réservés</p>
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const map = L.map('map', {
        zoomControl: false,
        scrollWheelZoom: false,
        dragging: window.innerWidth > 768,
        tap: false
      }).setView([43.5804, 7.1251], 10); // Antibes avec zoom plus large

      // Ajout des contrôles de zoom en bas à droite
      L.control.zoom({
        position: 'bottomright'
      }).addTo(map);

      // Fond de carte CartoDB Light (plus élégant)
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        maxZoom: 19
      }).addTo(map);

      // Zone standard (15 km)
      L.circle([43.5804, 7.1251], {
        color: '#28a745',
        fillColor: '#3bb78f',
        fillOpacity: 0.3,
        weight: 2,
        radius: 15000
      }).addTo(map).bindPopup("<strong>Zone standard</strong><br>99 € TTC<br><a href='/#tarifs' class='btn btn-sm btn-success'>Voir tarifs</a>");

      // Zone étendue (20 km)
      L.circle([43.5804, 7.1251], {
        color: '#fd7e14',
        fillColor: '#f39c12',
        fillOpacity: 0.2,
        weight: 2,
        radius: 20000
      }).addTo(map).bindPopup("<strong>Zone étendue</strong><br>109 € TTC<br><a href='/#tarifs' class='btn btn-sm btn-warning'>Voir tarifs</a>");

      // Ajout d'un bouton pour activer/désactiver le déplacement sur mobile
      if (window.innerWidth <= 768) {
        const dragButton = L.control({position: 'bottomleft'});
        dragButton.onAdd = function() {
          const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
          div.innerHTML = '<a href="#" title="Activer/désactiver le déplacement" style="font-weight: bold; display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; background: white; color: #0066cc;">↕</a>';
          div.onclick = function() {
            if (map.dragging.enabled()) {
              map.dragging.disable();
              div.querySelector('a').style.color = '#999';
            } else {
              map.dragging.enable();
              div.querySelector('a').style.color = '#0066cc';
            }
            return false;
          };
          return div;
        };
        dragButton.addTo(map);
      }
      
      // Forcer la mise à jour de la taille de la carte après le chargement
      setTimeout(function() {
        map.invalidateSize();
      }, 100);
      
      // Mettre à jour la taille de la carte lors du redimensionnement de la fenêtre
      window.addEventListener('resize', function() {
        map.invalidateSize();
      });
    });
  </script>
</body>
</html>